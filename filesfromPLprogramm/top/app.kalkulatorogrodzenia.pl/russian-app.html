<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∑–∞–±–æ—Ä–æ–≤ - Joniec¬Æ</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="user-scalable=no">
    <meta name="theme-color" content="#ffffff">
    
    <style>
        /* Reset –∏ –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            overflow: hidden;
            height: 100vh;
        }
        
        /* –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        #app {
            width: 100vw;
            height: 100vh;
            display: flex;
        }
        
        .col-panel {
            width: 320px;
            background: #ffffff;
            border-right: 2px solid #e9ecef;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        .row-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .col-workspace {
            flex: 1;
            position: relative;
            background: linear-gradient(180deg, #87CEEB 0%, #87CEEB 40%, #98FB98 70%, #8FBC8F 100%);
        }
        
        /* –ú–µ–Ω—é */
        .menu {
            display: flex;
            gap: 3px;
            padding: 10px;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .menu button {
            flex: 1;
            padding: 8px 6px;
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .menu button:hover {
            background: linear-gradient(135deg, #5a6268, #495057);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .menu button:active {
            transform: translateY(0);
        }
        
        /* –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ */
        .toolbar-main {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            background: #ffffff;
        }
        
        .toolbar-main > div {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .toolbar-main button {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .toolbar-main button:hover {
            background: linear-gradient(145deg, #e9ecef, #dee2e6);
            border-color: #adb5bd;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .toolbar-main button:active {
            transform: translateY(0);
        }
        
        .toolbar-main button span {
            width: 32px;
            height: 32px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        /* –ò–∫–æ–Ω–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∏–º–≤–æ–ª—ã Unicode) */
        .type-pole::after { content: "üèóÔ∏è"; position: absolute; font-size: 24px; }
        .type-curtain::after { content: "üß±"; position: absolute; font-size: 24px; }
        .type-wicket::after { content: "üö™"; position: absolute; font-size: 24px; }
        .type-gate::after { content: "üöß"; position: absolute; font-size: 24px; }
        .type-space::after { content: "‚è∏Ô∏è"; position: absolute; font-size: 24px; }
        .type-episode::after { content: "üìè"; position: absolute; font-size: 24px; }
        
        /* –ü–∞–Ω–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ */
        .toolbar-project {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            background: #f8f9fa;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .toolbar-project button {
            width: 45px;
            height: 45px;
            background: linear-gradient(145deg, #ffffff, #f1f3f4);
            border: 1px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 18px;
        }
        
        .toolbar-project button:hover {
            background: linear-gradient(145deg, #e9ecef, #dee2e6);
            border-color: #adb5bd;
        }
        
        /* –ò–∫–æ–Ω–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ */
        .type-colors-blocks::after { content: "üé®"; }
        .type-colors-peaks::after { content: "üî¥"; }
        .type-combo::after { content: "‚öôÔ∏è"; }
        .type-fencings::after { content: "üîß"; }
        .type-average::after { content: "üìê"; }
        .type-move::after { content: "‚ÜîÔ∏è"; }
        .type-migration::after { content: "üîÑ"; }
        .type-autosave::after { content: "üíæ"; }
        .type-settings::after { content: "‚öôÔ∏è"; }
        
        /* –ö–æ–Ω—Ç–µ–Ω—Ç –ø–∞–Ω–µ–ª–∏ */
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #ffffff;
        }
        
        .title h2 {
            margin: 0 0 20px 0;
            font-size: 18px;
            color: #2c3e50;
            font-weight: 600;
            text-align: center;
        }
        
        .options-group {
            margin-bottom: 20px;
        }
        
        .options-group h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #495057;
            font-weight: 500;
        }
        
        .options-group input {
            width: calc(100% - 40px);
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 14px;
            margin-right: 8px;
            transition: all 0.2s;
        }
        
        .options-group input:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.25);
        }
        
        .options-group small {
            color: #6c757d;
            font-size: 12px;
            font-weight: 500;
        }
        
        .content > button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #0d6efd, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(13, 110, 253, 0.3);
        }
        
        .content > button:hover {
            background: linear-gradient(135deg, #0056b3, #004085);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(13, 110, 253, 0.4);
        }
        
        .content > button:active {
            transform: translateY(0);
        }
        
        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å 2D/3D */
        .row-switcher {
            padding: 15px;
            border-top: 1px solid #dee2e6;
            background: #f8f9fa;
        }
        
        .row-switcher button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
        }
        
        .row-switcher button:hover {
            background: linear-gradient(135deg, #20c997, #17a2b8);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.4);
        }
        
        /* –†–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å */
        .row-workspace {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .canvas {
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .canvas canvas {
            width: 100%;
            height: 100%;
            display: block;
            cursor: crosshair;
        }
        
        /* –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —Ä–∞–±–æ—á–µ–π –æ–±–ª–∞—Å—Ç–∏ */
        .top-right {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 5;
        }
        
        .bottom-left {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 5;
        }
        
        .bottom-right {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 5;
        }
        
        /* –î–µ–Ω—å/–Ω–æ—á—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å */
        .day-night {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        .button-switch {
            position: relative;
            width: 60px;
            height: 30px;
            background: #e9ecef;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .button-switch-handler {
            position: absolute;
            width: 26px;
            height: 26px;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        /* –ö–Ω–æ–ø–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .button-image {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-size: 20px;
        }
        
        .button-image:hover {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }
        
        .button-image-type-environment::after { content: "üèûÔ∏è"; }
        .button-image-type-screenshot::after { content: "üì∑"; }
        .button-image-type-details::after { content: "‚öôÔ∏è"; }
        .button-image-type-window::after { content: "üëÅÔ∏è"; }
        
        /* –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ */
        .button-text {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .button-text:hover {
            background: linear-gradient(135deg, #c82333, #a71e2a);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(220, 53, 69, 0.4);
        }
        
        .button-text:active {
            transform: translateY(0);
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç—ã */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-in {
            animation: fadeIn 0.6s ease-out;
        }
        
        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 320px;
            right: 0;
            height: 30px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-size: 12px;
            z-index: 100;
        }
        
        .status-bar span {
            margin-right: 20px;
        }
        
        /* –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è file input */
        input[type="file"] {
            display: none;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            #app {
                flex-direction: column;
            }
            
            .col-panel {
                width: 100%;
                height: 45vh;
                border-right: none;
                border-bottom: 2px solid #dee2e6;
            }
            
            .col-workspace {
                height: 55vh;
            }
            
            .status-bar {
                left: 0;
            }
            
            .toolbar-main > div {
                grid-template-columns: repeat(6, 1fr);
                gap: 5px;
            }
            
            .toolbar-main button {
                width: 45px;
                height: 45px;
            }
            
            .toolbar-project {
                grid-template-columns: repeat(5, 1fr);
            }
            
            .toolbar-project button {
                width: 35px;
                height: 35px;
                font-size: 14px;
            }
        }
        
        /* –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞–≤–µ–¥–µ–Ω–∏—è */
        .toolbar-main button:hover::before {
            content: attr(title);
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="app" class="animate-in">
        <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="col-panel">
            <section>
                <div class="row-panel">
                    <!-- –ú–µ–Ω—é -->
                    <section class="menu">
                        <button title="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç (F9)" onclick="saveProject()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button title="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Å—Ç–æ–ª–±—ã –∏ —Å–µ–∫—Ü–∏–∏" onclick="clearProject()">–û—á–∏—Å—Ç–∏—Ç—å</button>
                        <button title="–°–±—Ä–æ—Å–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∏ –Ω–∞—á–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –∑–∞–Ω–æ–≤–æ" onclick="resetProject()">–°–±—Ä–æ—Å</button>
                        <button title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –ø—Ä–æ–µ–∫—Ç–æ–≤" onclick="closeProject()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </section>
                    
                    <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ -->
                    <section class="toolbar-main">
                        <div>
                            <button title="–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–æ–ª–±" class="type-pole" onclick="addPole()">
                                <span></span>
                            </button>
                            <button title="–î–æ–±–∞–≤–∏—Ç—å —Å—Ç–µ–Ω—É" class="type-curtain" onclick="addPanel()">
                                <span></span>
                            </button>
                            <button title="–î–æ–±–∞–≤–∏—Ç—å –∫–∞–ª–∏—Ç–∫—É" class="type-wicket" onclick="addWicket()">
                                <span></span>
                            </button>
                            <button title="–î–æ–±–∞–≤–∏—Ç—å –≤–æ—Ä–æ—Ç–∞" class="type-gate" onclick="addGate()">
                                <span></span>
                            </button>
                            <button title="–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–ø—É—Å–∫" class="type-space">
                                <span></span>
                            </button>
                            <button title="–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Ä–µ–∑–æ–∫" class="type-episode" onclick="addSegment()">
                                <span></span>
                            </button>
                        </div>
                    </section>
                    
                    <!-- –ü–∞–Ω–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ -->
                    <section class="toolbar-project">
                        <button title="–í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç –±–ª–æ–∫–æ–≤" class="type-colors-blocks"></button>
                        <button title="–í—ã–±—Ä–∞—Ç—å —Ü–≤–µ—Ç –∫—Ä—ã—à" class="type-colors-peaks"></button>
                        <button title="–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–º–±–æ" class="type-combo"></button>
                        <button title="–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è" class="type-fencings"></button>
                        <button title="–†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—Ç–æ–ª–±—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ" class="type-average"></button>
                        <button title="–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤" class="type-move"></button>
                        <button title="–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç –≤ –¥—Ä—É–≥—É—é —Å–∏—Å—Ç–µ–º—É" class="type-migration"></button>
                        <button title="–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ" class="type-autosave"></button>
                        <button title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞" class="type-settings"></button>
                    </section>
                    
                    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                    <div class="content">
                        <div class="title">
                            <h2>–î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Ä–µ–∑–æ–∫</h2>
                        </div>
                        <div class="options-group">
                            <h3>–î–ª–∏–Ω–∞</h3>
                            <input type="number" min="0.5" step="0.5" id="distance" value="15.0">
                            <small>–º</small>
                            
                            <h3>–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç–æ–ª–±–∞–º–∏</h3>
                            <input type="number" min="0.5" step="0.5" id="between" value="2.5">
                            <small>–º</small>
                            
                            <h3>–£–≥–æ–ª</h3>
                            <input type="number" min="-135" max="135" step="1" id="angle" value="0">
                            <small>¬∞</small>
                        </div>
                        <button onclick="addSegment()">–î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                </div>
                
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å 2D/3D -->
                <div class="row-switcher">
                    <button onclick="toggle2D3D()">2D/3D</button>
                </div>
            </section>
        </div>
        
        <!-- –†–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="col-workspace">
            <section>
                <div class="row-workspace">
                    <!-- Canvas -->
                    <div class="canvas">
                        <canvas id="mainCanvas"></canvas>
                    </div>
                    
                    <!-- –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                    <div class="top-right">
                        <!-- –î–µ–Ω—å/–Ω–æ—á—å -->
                        <div class="day-night">
                            <button title="–î–µ–Ω—å / –Ω–æ—á—å" class="button-switch" onclick="toggleDayNight()">
                                <span class="button-switch-handler"></span>
                            </button>
                        </div>
                        
                        <!-- –§–æ—Ç–æ —Ñ–æ–Ω -->
                        <button title="–ü—Ä–∏–º–µ—Ä–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –Ω–∞ —Ñ–æ—Ç–æ —É—á–∞—Å—Ç–∫–∞" class="button-image button-image-type-environment" onclick="document.getElementById('fileInput').click()"></button>
                        <input type="file" id="fileInput" accept="image/*" onchange="loadBackgroundImage(this)">
                        
                        <!-- –°–∫—Ä–∏–Ω—à–æ—Ç -->
                        <button title="–°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç" class="button-image button-image-type-screenshot" onclick="takeScreenshot()"></button>
                    </div>
                    
                    <div class="bottom-left">
                        <button title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∏" class="button-image button-image-type-details" onclick="openGraphicsSettings()"></button>
                        <button title="–ò–∑–º–µ–Ω–∏—Ç—å –≤–∏–¥" class="button-image button-image-type-window" onclick="changeView()"></button>
                    </div>
                    
                    <div class="bottom-right">
                        <button class="button-text" onclick="showPricing()">–†–∞—Å—á—ë—Ç</button>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä -->
    <div class="status-bar">
        <span id="statusElements">–≠–ª–µ–º–µ–Ω—Ç—ã: 0</span>
        <span id="statusLength">–î–ª–∏–Ω–∞: 0.0–º</span>
        <span id="statusCost">–°—Ç–æ–∏–º–æ—Å—Ç—å: 0 —Ä—É–±</span>
        <span id="statusMode">–†–µ–∂–∏–º: 2D</span>
    </div>

    <script>
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞
        let project = {
            elements: [],
            totalLength: 0,
            poleCount: 0,
            panelCount: 0,
            gateCount: 0,
            wicketCount: 0,
            totalCost: 0
        };
        
        let canvas, ctx;
        let isDayMode = true;
        let is3DMode = false;
        let backgroundImage = null;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        function init() {
            canvas = document.getElementById('mainCanvas');
            if (canvas) {
                ctx = canvas.getContext('2d');
                setupCanvas();
                drawScene();
                updateStatus();
                
                // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
                setTimeout(() => {
                    showMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ó–∞–±–æ—Ä–æ–≤ Joniec! üèóÔ∏è', 3000);
                }, 1000);
            }
        }
        
        function setupCanvas() {
            const container = canvas.parentElement;
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            
            window.addEventListener('resize', () => {
                canvas.width = container.offsetWidth;
                canvas.height = container.offsetHeight;
                drawScene();
            });
            
            // Mouse events –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            canvas.addEventListener('click', onCanvasClick);
            canvas.addEventListener('mousemove', onCanvasMouseMove);
        }
        
        function drawScene() {
            if (!ctx) return;
            
            // –û—á–∏—Å—Ç–∫–∞
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –§–æ–Ω
            drawBackground();
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –æ–≥—Ä–∞–∂–¥–µ–Ω–∏—è
            drawFenceElements();
            
            // –°–µ—Ç–∫–∞
            if (!is3DMode) {
                drawGrid();
            }
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            drawInfo();
        }
        
        function drawBackground() {
            if (backgroundImage) {
                ctx.drawImage(backgroundImage, 0, 0, canvas.width, canvas.height);
                return;
            }
            
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç –Ω–µ–±–∞
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            if (isDayMode) {
                gradient.addColorStop(0, '#87CEEB');
                gradient.addColorStop(0.4, '#87CEEB');
                gradient.addColorStop(0.7, '#98FB98');
                gradient.addColorStop(1, '#8FBC8F');
            } else {
                gradient.addColorStop(0, '#2C3E50');
                gradient.addColorStop(0.4, '#34495E');
                gradient.addColorStop(0.7, '#1A252F');
                gradient.addColorStop(1, '#0F1419');
            }
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –õ–æ–≥–æ—Ç–∏–ø—ã Joniec
            drawJoniecLogos();
        }
        
        function drawJoniecLogos() {
            const groundY = canvas.height * 0.8;
            
            ctx.fillStyle = isDayMode ? 'rgba(220, 38, 38, 0.1)' : 'rgba(52, 152, 219, 0.1)';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            
            for (let x = 150; x < canvas.width; x += 300) {
                for (let y = groundY + 30; y < canvas.height; y += 120) {
                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(-0.2);
                    ctx.fillText('JONIEC', 0, 0);
                    ctx.restore();
                }
            }
        }
        
        function drawGrid() {
            ctx.strokeStyle = isDayMode ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = 1;
            
            const gridSize = 50;
            
            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }
        
        function drawFenceElements() {
            let currentX = 100;
            const groundY = canvas.height * 0.75;
            
            project.elements.forEach((element, index) => {
                const isSelected = element.selected;
                
                switch (element.type) {
                    case 'pole':
                        drawPole(currentX, groundY, isSelected);
                        currentX += 10;
                        break;
                    case 'panel':
                        drawPanel(currentX, groundY, element.length || 150, isSelected);
                        currentX += element.length || 150;
                        break;
                    case 'gate':
                        drawGate(currentX, groundY, isSelected);
                        currentX += 120;
                        break;
                    case 'wicket':
                        drawWicket(currentX, groundY, isSelected);
                        currentX += 80;
                        break;
                }
            });
        }
        
        function drawPole(x, y, isSelected = false) {
            // –¢–µ–Ω—å
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(x + 5, y - 5, 15, 5);
            
            // –°—Ç–æ–ª–±
            ctx.fillStyle = isSelected ? '#FF6B6B' : '#8B4513';
            ctx.fillRect(x - 10, y - 100, 20, 100);
            
            // –ë–ª–∏–∫
            ctx.fillStyle = isSelected ? '#FFD93D' : '#CD853F';
            ctx.fillRect(x - 10, y - 100, 6, 100);
            
            // –í–µ—Ä—Ö—É—à–∫–∞
            ctx.fillStyle = isSelected ? '#4ECDC4' : '#A0522D';
            ctx.fillRect(x - 12, y - 105, 24, 8);
            
            if (isSelected) {
                // –û–±–≤–æ–¥–∫–∞
                ctx.strokeStyle = '#FF1744';
                ctx.lineWidth = 3;
                ctx.strokeRect(x - 12, y - 105, 24, 105);
            }
        }
        
        function drawPanel(x, y, length, isSelected = false) {
            // –¢–µ–Ω—å
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(x + 3, y - 3, length, 3);
            
            // –ü–∞–Ω–µ–ª—å
            ctx.fillStyle = isSelected ? '#FF6B6B' : '#708090';
            ctx.fillRect(x, y - 80, length, 80);
            
            // –†–∞–º–∫–∞
            ctx.strokeStyle = isSelected ? '#FFD93D' : '#2F4F4F';
            ctx.lineWidth = 3;
            ctx.strokeRect(x, y - 80, length, 80);
            
            // –î–µ–ª–µ–Ω–∏—è
            const divisions = Math.floor(length / 30);
            for (let i = 1; i < divisions; i++) {
                ctx.beginPath();
                ctx.moveTo(x + (length * i) / divisions, y - 80);
                ctx.lineTo(x + (length * i) / divisions, y);
                ctx.stroke();
            }
            
            // –¢–µ–∫—Å—Ç—É—Ä–∞
            ctx.fillStyle = isSelected ? 'rgba(255, 215, 61, 0.3)' : 'rgba(255, 255, 255, 0.1)';
            for (let i = 0; i < divisions; i++) {
                const sectionX = x + (length * i) / divisions;
                const sectionW = length / divisions;
                ctx.fillRect(sectionX + 2, y - 78, sectionW - 4, 76);
            }
            
            if (isSelected) {
                // –û–±–≤–æ–¥–∫–∞
                ctx.strokeStyle = '#FF1744';
                ctx.lineWidth = 4;
                ctx.strokeRect(x - 2, y - 82, length + 4, 84);
            }
        }
        
        function drawGate(x, y, isSelected = false) {
            // –¢–µ–Ω—å
            ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
            ctx.fillRect(x + 4, y - 4, 120, 4);
            
            // –õ–µ–≤–∞—è —Å—Ç–≤–æ—Ä–∫–∞
            ctx.fillStyle = isSelected ? '#FF6B6B' : '#4682B4';
            ctx.fillRect(x, y - 100, 58, 100);
            
            // –ü—Ä–∞–≤–∞—è —Å—Ç–≤–æ—Ä–∫–∞
            ctx.fillRect(x + 62, y - 100, 58, 100);
            
            // –†–∞–º–∫–∏ —Å—Ç–≤–æ—Ä–æ–∫
            ctx.strokeStyle = isSelected ? '#FFD93D' : '#191970';
            ctx.lineWidth = 4;
            ctx.strokeRect(x, y - 100, 58, 100);
            ctx.strokeRect(x + 62, y - 100, 58, 100);
            
            // –†—É—á–∫–∏
            ctx.fillStyle = isSelected ? '#4ECDC4' : '#FFD700';
            ctx.beginPath();
            ctx.arc(x + 45, y - 50, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(x + 75, y - 50, 4, 0, Math.PI * 2);
            ctx.fill();
            
            if (isSelected) {
                // –û–±–≤–æ–¥–∫–∞
                ctx.strokeStyle = '#FF1744';
                ctx.lineWidth = 4;
                ctx.strokeRect(x - 2, y - 102, 124, 104);
            }
        }
        
        function drawWicket(x, y, isSelected = false) {
            // –¢–µ–Ω—å
            ctx.fillStyle = 'rgba(0, 0, 0, 0.25)';
            ctx.fillRect(x + 3, y - 3, 80, 3);
            
            // –ö–∞–ª–∏—Ç–∫–∞
            ctx.fillStyle = isSelected ? '#FF6B6B' : '#8B0000';
            ctx.fillRect(x, y - 85, 80, 85);
            
            // –†–∞–º–∫–∞
            ctx.strokeStyle = isSelected ? '#FFD93D' : '#4B0000';
            ctx.lineWidth = 3;
            ctx.strokeRect(x, y - 85, 80, 85);
            
            // –†—É—á–∫–∞
            ctx.fillStyle = isSelected ? '#4ECDC4' : '#FFD700';
            ctx.beginPath();
            ctx.arc(x + 65, y - 42, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ä–µ—à–µ—Ç–∫–∞
            ctx.strokeStyle = isSelected ? 'rgba(255, 215, 61, 0.7)' : 'rgba(255, 255, 255, 0.3)';
            ctx.lineWidth = 2;
            for (let i = 1; i < 4; i++) {
                ctx.beginPath();
                ctx.moveTo(x + 10, y - 85 + (85 * i) / 4);
                ctx.lineTo(x + 70, y - 85 + (85 * i) / 4);
                ctx.stroke();
            }
            
            if (isSelected) {
                // –û–±–≤–æ–¥–∫–∞
                ctx.strokeStyle = '#FF1744';
                ctx.lineWidth = 4;
                ctx.strokeRect(x - 2, y - 87, 84, 89);
            }
        }
        
        function drawInfo() {
            if (project.elements.length === 0) {
                ctx.fillStyle = isDayMode ? 'rgba(0, 0, 0, 0.7)' : 'rgba(255, 255, 255, 0.8)';
                ctx.font = 'bold 24px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–±–æ—Ä–∞', canvas.width / 2, canvas.height / 2);
                
                ctx.font = '16px Arial';
                ctx.fillText('üèóÔ∏è –°—Ç–æ–ª–±  üß± –ü–∞–Ω–µ–ª—å  üö™ –ö–∞–ª–∏—Ç–∫–∞  üöß –í–æ—Ä–æ—Ç–∞', canvas.width / 2, canvas.height / 2 + 40);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function addSegment() {
            const distance = parseFloat(document.getElementById('distance').value) || 15;
            const between = parseFloat(document.getElementById('between').value) || 2.5;
            const angle = parseFloat(document.getElementById('angle').value) || 0;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∞—Ç–Ω–æ—Å—Ç–∏ 0.5
            if (distance % 0.5 !== 0) {
                showMessage('–î–ª–∏–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–∞ 0.5 –º–µ—Ç—Ä–∞!', 2000);
                return;
            }
            
            if (between % 0.5 !== 0) {
                showMessage('–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç–æ–ª–±–∞–º–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ 0.5 –º–µ—Ç—Ä–∞!', 2000);
                return;
            }
            
            const segmentLength = distance * 10; // –ú–∞—Å—à—Ç–∞–± –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
            
            const segment = {
                type: 'panel',
                length: segmentLength,
                realLength: distance,
                angle: angle,
                id: Date.now(),
                selected: false
            };
            
            project.elements.push(segment);
            project.panelCount++;
            project.totalLength += distance;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–æ–ª–± –≤ –∫–æ–Ω—Ü–µ
            const pole = {
                type: 'pole',
                id: Date.now() + 1,
                selected: false
            };
            project.elements.push(pole);
            project.poleCount++;
            
            updateCalculations();
            drawScene();
            updateStatus();
            showMessage(`–î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Ä–µ–∑–æ–∫ ${distance}–º`, 2000);
        }
        
        function addPole() {
            const pole = {
                type: 'pole',
                id: Date.now(),
                selected: false
            };
            project.elements.push(pole);
            project.poleCount++;
            
            updateCalculations();
            drawScene();
            updateStatus();
            showMessage('–î–æ–±–∞–≤–ª–µ–Ω —Å—Ç–æ–ª–±', 1500);
        }
        
        function addPanel() {
            const between = parseFloat(document.getElementById('between').value) || 2.5;
            
            if (between % 0.5 !== 0) {
                showMessage('–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∞—Ç–Ω–æ 0.5 –º–µ—Ç—Ä–∞!', 2000);
                return;
            }
            
            const panel = {
                type: 'panel',
                length: between * 40,
                realLength: between,
                id: Date.now(),
                selected: false
            };
            project.elements.push(panel);
            project.panelCount++;
            project.totalLength += between;
            
            updateCalculations();
            drawScene();
            updateStatus();
            showMessage(`–î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞–Ω–µ–ª—å ${between}–º`, 1500);
        }
        
        function addGate() {
            const gate = {
                type: 'gate',
                id: Date.now(),
                selected: false
            };
            project.elements.push(gate);
            project.gateCount++;
            project.totalLength += 4.0;
            
            updateCalculations();
            drawScene();
            updateStatus();
            showMessage('–î–æ–±–∞–≤–ª–µ–Ω—ã –≤–æ—Ä–æ—Ç–∞', 1500);
        }
        
        function addWicket() {
            const wicket = {
                type: 'wicket',
                id: Date.now(),
                selected: false
            };
            project.elements.push(wicket);
            project.wicketCount++;
            project.totalLength += 1.5;
            
            updateCalculations();
            drawScene();
            updateStatus();
            showMessage('–î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–∞–ª–∏—Ç–∫–∞', 1500);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—á–µ—Ç–æ–≤ (—Ü–µ–Ω—ã –≤ —Ä—É–±–ª—è—Ö)
        function updateCalculations() {
            const poleCost = 4500;      // —Ä—É–± –∑–∞ —Å—Ç–æ–ª–±
            const panelCost = 2400;     // —Ä—É–± –∑–∞ –º2 –ø–∞–Ω–µ–ª–∏
            const gateCost = 24000;     // —Ä—É–± –∑–∞ –≤–æ—Ä–æ—Ç–∞
            const wicketCost = 12000;   // —Ä—É–± –∑–∞ –∫–∞–ª–∏—Ç–∫—É
            
            project.totalCost = 
                (project.poleCount * poleCost) +
                (project.totalLength * panelCost) +
                (project.gateCount * gateCost) +
                (project.wicketCount * wicketCost);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å –±–∞—Ä–∞
        function updateStatus() {
            document.getElementById('statusElements').textContent = `–≠–ª–µ–º–µ–Ω—Ç—ã: ${project.elements.length}`;
            document.getElementById('statusLength').textContent = `–î–ª–∏–Ω–∞: ${project.totalLength.toFixed(1)}–º`;
            document.getElementById('statusCost').textContent = `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${project.totalCost.toFixed(0)} —Ä—É–±`;
            document.getElementById('statusMode').textContent = `–†–µ–∂–∏–º: ${is3DMode ? '3D' : '2D'}`;
        }
        
        // –°–æ–±—ã—Ç–∏—è –º—ã—à–∏
        function onCanvasClick(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º
            let clickedElement = null;
            let currentX = 100;
            const groundY = canvas.height * 0.75;
            
            project.elements.forEach((element, index) => {
                let elementWidth = 0;
                
                switch (element.type) {
                    case 'pole':
                        elementWidth = 20;
                        if (x >= currentX - 10 && x <= currentX + 10 && y >= groundY - 100 && y <= groundY) {
                            clickedElement = element;
                        }
                        currentX += 10;
                        break;
                    case 'panel':
                        elementWidth = element.length || 150;
                        if (x >= currentX && x <= currentX + elementWidth && y >= groundY - 80 && y <= groundY) {
                            clickedElement = element;
                        }
                        currentX += elementWidth;
                        break;
                    case 'gate':
                        elementWidth = 120;
                        if (x >= currentX && x <= currentX + elementWidth && y >= groundY - 100 && y <= groundY) {
                            clickedElement = element;
                        }
                        currentX += elementWidth;
                        break;
                    case 'wicket':
                        elementWidth = 80;
                        if (x >= currentX && x <= currentX + elementWidth && y >= groundY - 85 && y <= groundY) {
                            clickedElement = element;
                        }
                        currentX += elementWidth;
                        break;
                }
            });
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            project.elements.forEach(el => el.selected = false);
            
            // –í—ã–¥–µ–ª—è–µ–º –∫–ª–∏–∫–Ω—É—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç
            if (clickedElement) {
                clickedElement.selected = true;
                showMessage(`–í—ã–±—Ä–∞–Ω–æ: ${getElementName(clickedElement.type)}`, 1500);
            }
            
            drawScene();
        }
        
        function getElementName(type) {
            const names = {
                'pole': '—Å—Ç–æ–ª–±',
                'panel': '–ø–∞–Ω–µ–ª—å',
                'gate': '–≤–æ—Ä–æ—Ç–∞',
                'wicket': '–∫–∞–ª–∏—Ç–∫–∞'
            };
            return names[type] || type;
        }
        
        function onCanvasMouseMove(event) {
            canvas.style.cursor = 'crosshair';
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        function saveProject() {
            const projectData = {
                ...project,
                timestamp: new Date().toLocaleString('ru-RU'),
                version: '2.0',
                system: 'Joniec Enhanced Russian'
            };
            
            const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const date = new Date().toISOString().split('T')[0];
            a.download = `–ø—Ä–æ–µ–∫—Ç-joniec-${date}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showMessage('–ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω! üíæ', 2500);
        }
        
        function clearProject() {
            if (project.elements.length === 0) {
                showMessage('–ü—Ä–æ–µ–∫—Ç —É–∂–µ –ø—É—Å—Ç', 1500);
                return;
            }
            
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã?')) {
                project = {
                    elements: [],
                    totalLength: 0,
                    poleCount: 0,
                    panelCount: 0,
                    gateCount: 0,
                    wicketCount: 0,
                    totalCost: 0
                };
                drawScene();
                updateStatus();
                showMessage('–ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω! üßπ', 2000);
            }
        }
        
        function resetProject() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?')) {
                document.getElementById('distance').value = 15.0;
                document.getElementById('between').value = 2.5;
                document.getElementById('angle').value = 0;
                clearProject();
                showMessage('–ü—Ä–æ–µ–∫—Ç —Å–±—Ä–æ—à–µ–Ω! üîÑ', 2000);
            }
        }
        
        function closeProject() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –ø—Ä–æ–µ–∫—Ç?')) {
                showMessage('–ó–∞–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ–µ–∫—Ç... üëã', 2000);
                setTimeout(() => {
                    window.close();
                }, 2000);
            }
        }
        
        function toggle2D3D() {
            is3DMode = !is3DMode;
            const button = document.querySelector('.row-switcher button');
            button.textContent = is3DMode ? '3D ‚úì' : '2D/3D';
            button.style.background = is3DMode ? 
                'linear-gradient(135deg, #17a2b8, #138496)' : 
                'linear-gradient(135deg, #28a745, #20c997)';
            
            drawScene();
            updateStatus();
            showMessage(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —Ä–µ–∂–∏–º ${is3DMode ? '3D' : '2D'}`, 1500);
        }
        
        function toggleDayNight() {
            isDayMode = !isDayMode;
            const handler = document.querySelector('.button-switch-handler');
            
            if (isDayMode) {
                handler.style.transform = 'translateX(0px)';
                handler.style.background = 'linear-gradient(145deg, #FFD700, #FFA500)';
            } else {
                handler.style.transform = 'translateX(30px)';
                handler.style.background = 'linear-gradient(145deg, #4A90E2, #357ABD)';
            }
            
            drawScene();
            showMessage(isDayMode ? '–î–Ω–µ–≤–Ω–æ–π —Ä–µ–∂–∏–º ‚òÄÔ∏è' : '–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º üåô', 1500);
        }
        
        function showPricing() {
            updateCalculations();
            
            let pricing = 'üí∞ –†–ê–°–ß–Å–¢ –ü–†–û–ï–ö–¢–ê JONIEC\n\n';
            pricing += 'üìä –≠–õ–ï–ú–ï–ù–¢–´:\n';
            if (project.poleCount > 0) pricing += `üèóÔ∏è –°—Ç–æ–ª–±—ã: ${project.poleCount} —à—Ç. √ó 4 500 —Ä—É–± = ${(project.poleCount * 4500).toLocaleString('ru-RU')} —Ä—É–±\n`;
            if (project.panelCount > 0) pricing += `üß± –ü–∞–Ω–µ–ª–∏: ${project.totalLength.toFixed(1)}–º √ó 2 400 —Ä—É–±/–º = ${(project.totalLength * 2400).toLocaleString('ru-RU')} —Ä—É–±\n`;
            if (project.gateCount > 0) pricing += `üöß –í–æ—Ä–æ—Ç–∞: ${project.gateCount} —à—Ç. √ó 24 000 —Ä—É–± = ${(project.gateCount * 24000).toLocaleString('ru-RU')} —Ä—É–±\n`;
            if (project.wicketCount > 0) pricing += `üö™ –ö–∞–ª–∏—Ç–∫–∏: ${project.wicketCount} —à—Ç. √ó 12 000 —Ä—É–± = ${(project.wicketCount * 12000).toLocaleString('ru-RU')} —Ä—É–±\n`;
            
            pricing += `\nüìè –û–±—â–∞—è –¥–ª–∏–Ω–∞: ${project.totalLength.toFixed(1)}–º`;
            pricing += `\nüíµ –ò–¢–û–ì–û: ${project.totalCost.toLocaleString('ru-RU')} —Ä—É–±`;
            pricing += `\n\nüìû –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏:\nüåê www.joniec.ru\nüìß info@joniec.ru\n‚òéÔ∏è +7 (495) 123-45-67`;
            
            alert(pricing);
        }
        
        function takeScreenshot() {
            const link = document.createElement('a');
            const date = new Date().toISOString().split('T')[0];
            link.download = `joniec-–ø—Ä–æ–µ–∫—Ç-${date}.png`;
            link.href = canvas.toDataURL();
            link.click();
            showMessage('–°–∫—Ä–∏–Ω—à–æ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω! üì∑', 2000);
        }
        
        function loadBackgroundImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        backgroundImage = img;
                        drawScene();
                        showMessage(`–ó–∞–≥—Ä—É–∂–µ–Ω —Ñ–æ–Ω: ${input.files[0].name} üèûÔ∏è`, 2500);
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function openGraphicsSettings() {
            const settings = prompt(
                '–ù–ê–°–¢–†–û–ô–ö–ò –ì–†–ê–§–ò–ö–ò:\n\n' +
                '1. –£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω (–≤–≤–µ–¥–∏—Ç–µ: "clear")\n' +
                '2. –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ (–≤–≤–µ–¥–∏—Ç–µ: "high" –∏–ª–∏ "low")\n' +
                '3. –°–±—Ä–æ—Å –≤–∏–¥–∞ (–≤–≤–µ–¥–∏—Ç–µ: "reset")\n\n' +
                '–ß—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å?'
            );
            
            if (settings) {
                switch(settings.toLowerCase()) {
                    case 'clear':
                        backgroundImage = null;
                        drawScene();
                        showMessage('–§–æ–Ω —É–¥–∞–ª—ë–Ω', 1500);
                        break;
                    case 'high':
                        canvas.style.imageRendering = 'auto';
                        showMessage('–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ', 1500);
                        break;
                    case 'low':
                        canvas.style.imageRendering = 'pixelated';
                        showMessage('–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ', 1500);
                        break;
                    case 'reset':
                        canvas.style.imageRendering = 'auto';
                        backgroundImage = null;
                        drawScene();
                        showMessage('–°–±—Ä–æ—Å –≤–∏–¥–∞', 1500);
                        break;
                    default:
                        showMessage('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞', 1500);
                }
            }
        }
        
        function changeView() {
            const views = ['–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π', '–ü–∞–Ω–æ—Ä–∞–º–∞', '–î–µ—Ç–∞–ª—å–Ω—ã–π', '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π'];
            const currentView = localStorage.getItem('currentView') || '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π';
            const currentIndex = views.indexOf(currentView);
            const nextIndex = (currentIndex + 1) % views.length;
            const nextView = views[nextIndex];
            
            localStorage.setItem('currentView', nextView);
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç —Å–º–µ–Ω—ã –≤–∏–¥–∞
            canvas.style.filter = 'brightness(1.2) contrast(1.1)';
            setTimeout(() => {
                canvas.style.filter = 'none';
            }, 300);
            
            showMessage(`–í–∏–¥: ${nextView} üëÅÔ∏è`, 1500);
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showMessage(text, duration = 2000) {
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const message = document.createElement('div');
            message.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.8);
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                font-size: 16px;
                font-weight: 500;
                z-index: 10000;
                animation: fadeInOut ${duration}ms ease-in-out;
                text-align: center;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            
            message.textContent = text;
            document.body.appendChild(message);
            
            setTimeout(() => {
                if (message.parentNode) {
                    message.parentNode.removeChild(message);
                }
            }, duration);
        }
        
        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(e) {
            switch(e.key) {
                case 'F9':
                    e.preventDefault();
                    saveProject();
                    break;
                case 'Delete':
                case 'Backspace':
                    // –£–¥–∞–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                    const selectedIndex = project.elements.findIndex(el => el.selected);
                    if (selectedIndex !== -1) {
                        const element = project.elements[selectedIndex];
                        project.elements.splice(selectedIndex, 1);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏
                        switch(element.type) {
                            case 'pole': project.poleCount--; break;
                            case 'panel': 
                                project.panelCount--; 
                                project.totalLength -= element.realLength || 0;
                                break;
                            case 'gate': 
                                project.gateCount--; 
                                project.totalLength -= 4.0;
                                break;
                            case 'wicket': 
                                project.wicketCount--; 
                                project.totalLength -= 1.5;
                                break;
                        }
                        
                        updateCalculations();
                        drawScene();
                        updateStatus();
                        showMessage(`–£–¥–∞–ª—ë–Ω ${getElementName(element.type)}`, 1500);
                    }
                    break;
                case ' ':
                    e.preventDefault();
                    toggle2D3D();
                    break;
                case 'Escape':
                    // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                    project.elements.forEach(el => el.selected = false);
                    drawScene();
                    break;
            }
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            }
        `;
        document.head.appendChild(style);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            init();
        });
    </script>
</body>
</html>

